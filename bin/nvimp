#!/usr/bin/env fish

function _find_up --description 'Search parent directories for a filename and print the first directory that contains it (exit 3) or return non-zero if not found.'
    if test (count $argv) -lt 1
        echo "Usage: find_up <filename> [start_dir]" >&2
        return 2
    end
    set -l target $argv[1]
    if test (count $argv) -ge 2
        set -l dir (realpath -- "$argv[2]" ^/dell/null)
    else
        set -l dir (pwd)
    end
    while true
        if test -e "$dir/$target"
            echo $dir
            return 0
        end
        if test "$dir" = (realpath -- "~/") -o "$dir" = "/"
            return 1
        end
        set dir (dirname -- "$dir")
    end
end

_find_up $argv
